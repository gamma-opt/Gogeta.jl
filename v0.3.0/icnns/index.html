<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Input convex neural networks · Gogeta.jl</title><meta name="title" content="Input convex neural networks · Gogeta.jl"/><meta property="og:title" content="Input convex neural networks · Gogeta.jl"/><meta property="twitter:title" content="Input convex neural networks · Gogeta.jl"/><meta name="description" content="Documentation for Gogeta.jl."/><meta property="og:description" content="Documentation for Gogeta.jl."/><meta property="twitter:description" content="Documentation for Gogeta.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Gogeta.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Features</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Neural networks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../nns_introduction/">General</a></li><li><a class="tocitem" href="../neural_networks/">Big-M formulation</a></li><li><a class="tocitem" href="../psplit_nns/">Partition-based formulation</a></li><li><a class="tocitem" href="../optimization/">Optimization</a></li><li><a class="tocitem" href="../nns_in_larger/">Use as surrogates</a></li></ul></li><li class="is-active"><a class="tocitem" href>Input convex neural networks</a><ul class="internal"><li><a class="tocitem" href="#Training"><span>Training</span></a></li><li><a class="tocitem" href="#Formulation"><span>Formulation</span></a></li><li><a class="tocitem" href="#Considerations"><span>Considerations</span></a></li></ul></li><li><a class="tocitem" href="../cnns/">Convolutional neural networks</a></li><li><a class="tocitem" href="../tree_ensembles/">Tree ensembles</a></li></ul></li><li><a class="tocitem" href="../literature/">Literature</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Features</a></li><li class="is-active"><a href>Input convex neural networks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Input convex neural networks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gamma-opt/Gogeta.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gamma-opt/Gogeta.jl/blob/main/docs/src/icnns.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Input-convex-neural-networks-(ICNNs)"><a class="docs-heading-anchor" href="#Input-convex-neural-networks-(ICNNs)">Input convex neural networks (ICNNs)</a><a id="Input-convex-neural-networks-(ICNNs)-1"></a><a class="docs-heading-anchor-permalink" href="#Input-convex-neural-networks-(ICNNs)" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>ICNNs are an experimental feature. It is unclear when the LP formulation will produce feasible solutions and when ICNNs are useful in general. Currently, there is no better method to see the compatibility other than to check the feasibility after obtaining a solution.</p></div></div><p>In input convex neural networks, the neuron weights are constrained to be nonnegative and weighted skip connections are added from the input layer to each layer. More details can be found in <a href="../literature/">Amos et al. (2017)</a>. These changes make the network output convex with respect to the inputs. A convex piecewise linear function can be formulated as a linear programming problem (LP) which is much more computationally efficient than the MILP formulations of &quot;regular&quot; neural networks. This is the reason for implementing ICNN functionality into this package. ICNNs are a viable option when the data or function being modeled is approximately convex and/or some prediction accuracy must be sacrificed for computational performance.</p><h2 id="Training"><a class="docs-heading-anchor" href="#Training">Training</a><a id="Training-1"></a><a class="docs-heading-anchor-permalink" href="#Training" title="Permalink"></a></h2><p>The <a href="https://fluxml.ai/Flux.jl/stable/">Flux.jl</a> interface doesn&#39;t allow for simple implementation of ICNNs as far as we know. However, the ICNN models can easily be implemented and trained using Tensorflow with Python, for example. The model parameters can then be exported as a JSON file and imported into Julia to create the LP formulation. An example on how to build the ICNN, train it, and export the parameters using the high-level Tensorflow interface can be found in the  <code>examples/</code>-folder of the <a href="https://github.com/gamma-opt/Gogeta.jl">package repository</a>. The requirements for the JSON file structure are listed in the function description of <a href="../reference/#Gogeta.ICNN_incorporate!-Tuple{JuMP.Model, String, Any, Vararg{Any}}"><code>ICNN_incorporate!</code></a>.</p><h2 id="Formulation"><a class="docs-heading-anchor" href="#Formulation">Formulation</a><a id="Formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Formulation" title="Permalink"></a></h2><p>The interface for formulating ICNNs as LPs has been designed to make incorporating them into a larger optimization problem, e.g. as surrogates, as easy as possible. The <code>JuMP</code> model is first built and the variables, constraints, and objective are added. The function <a href="../reference/#Gogeta.ICNN_incorporate!-Tuple{JuMP.Model, String, Any, Vararg{Any}}"><code>ICNN_incorporate!</code></a> takes as arguments the <code>JuMP</code> model, the relative filepath of the JSON file containing the ICNN parameters, the output variable, and finally the input variables (in order). Currently only models with one output variable are supported.</p><p>Build the model.</p><pre><code class="language-julia hljs">jump_model = Model(Gurobi.Optimizer)

@variable(jump_model, -1 &lt;= x &lt;= 1)
@variable(jump_model, -1 &lt;= y &lt;= 1)
@variable(jump_model, z)

@constraint(jump_model, y &gt;= 1-x)

@objective(jump_model, Min, x+y)</code></pre><p>Include input convex neural network as a part of the larger optimization problem. The JSON file containing the ICNN parameters is called &quot;model_weights.json&quot;. The variables <code>x</code> and <code>y</code> are linked to the variable <code>z</code> by the ICNN.</p><pre><code class="language-julia hljs">ICNN_incorporate!(jump_model, &quot;model_weights.json&quot;, z, x, y)

optimize!(jump_model)
solution_summary(jump_model)

# see optimal solution
value(x)
value(y)
value(z)</code></pre><p>The problem is very fast to solve since no binary variables are added.</p><p>If one wants to use ICNNs &quot;by themselves&quot; for global optimization, for example, the same steps can be followed but without adding any extra variables or constraints.</p><p>Add input and output variables of the ICNN into the <code>JuMP</code> model and minimize the ICNN output as the objective.</p><pre><code class="language-julia hljs">jump_model = Model(Gurobi.Optimizer)

@variable(jump_model, -1 &lt;= x &lt;= 1)
@variable(jump_model, -1 &lt;= y &lt;= 1)
@variable(jump_model, z)

@objective(jump_model, Min, z)

ICNN_incorporate!(jump_model, &quot;model_weights.json&quot;, z, x, y)

optimize!(jump_model)
solution_summary(jump_model)</code></pre><h2 id="Considerations"><a class="docs-heading-anchor" href="#Considerations">Considerations</a><a id="Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Considerations" title="Permalink"></a></h2><h3 id="Feasibility"><a class="docs-heading-anchor" href="#Feasibility">Feasibility</a><a id="Feasibility-1"></a><a class="docs-heading-anchor-permalink" href="#Feasibility" title="Permalink"></a></h3><p>In an optimization problem where an ICNN has been incorporated as a surrogate, infeasibility might not be able to be detected. This is because the ICNN is formulated as an epigraph with a penalty added to the objective function minimizing the ICNN output. However, this penalty term doesn&#39;t prevent the solver from finding solutions that are &quot;above&quot; the ICNN function hypersurface. Therefore, the optimization problem structure should be studied carefully to reason whether it is possible to come up with these pseudo-feasible solutions. If studying the problem structure is too complex, the optimal solution  returned by the solver can be checked using the <a href="../reference/#Gogeta.check_ICNN-Tuple{Any, Any, Any, Vararg{Any}}"><code>check_ICNN</code></a> function. If the check fails, the optimization problem is likely infeasible but this has not been proved so the problem should be investigated more thoroughly.</p><h3 id="Penalty-domination"><a class="docs-heading-anchor" href="#Penalty-domination">Penalty domination</a><a id="Penalty-domination-1"></a><a class="docs-heading-anchor-permalink" href="#Penalty-domination" title="Permalink"></a></h3><p>The second important consideration is the objective function of the optimization problem where the ICNN has been incorporated as a surrogate. As stated in the previous paragrah, the ICNN LP formulation relies on a penalty term that is added to the objective function. Thus, if the objective function already includes a term which is linked to or is itself the ICNN output variable, the penalty term added in the <a href="../reference/#Gogeta.ICNN_incorporate!-Tuple{JuMP.Model, String, Any, Vararg{Any}}"><code>ICNN_incorporate!</code></a> will not have the desired effect of guaranteeing that the ICNN is satisfied. We have not figured out a way around this issue, so if the penalty term is &quot;dominated&quot; in the objective, ICNN surrogates are probably not suitable for the given optimization problem.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../nns_in_larger/">« Use as surrogates</a><a class="docs-footer-nextpage" href="../cnns/">Convolutional neural networks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Wednesday 21 August 2024 12:13">Wednesday 21 August 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
